@page "/"
@implements IDisposable
@rendermode InteractiveServer
@inject IImageService ImageService
@inject ILogger<Home> Logger

<div class="grid-container">
    @if (_images.Count > 0)
    {
        @for (int i = 0; i < _images.Count; i++)
        {
            var imageUrl = i < _images.Count ? _images[i].Url : "/api/placeholder/300/300";
            <div class="grid-item">
                <img src="@imageUrl" alt="Grid Item @(i + 1)">
            </div>
        }
    }
</div>

<style>
    .grid-container {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 10px;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }

    .grid-item {
        width: 100%;
        aspect-ratio: 1;
        overflow: hidden;
    }

    .grid-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
</style>

@code {
    private List<ImageModel> _images = new();
    
    protected override void OnInitialized()
    {
        Logger.LogInformation("Entered OnInitialized");
        _images = ImageService.GetImages();
        ImageService.NewImagesFound += SetImages;
    }

    private async Task SetImages()
    {
        Logger.LogInformation("Just entered SetImages");
        
        await InvokeAsync(() => {
            _images = ImageService.GetImages();
            Logger.LogInformation("Just set images");
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        Logger.LogInformation("Disposing Home");
        ImageService.NewImagesFound -= SetImages;
    }
}