@page "/"
@implements IDisposable
@rendermode InteractiveServer
@inject IImageService ImageService
@inject ILogger<Home> Logger

<div class="grid grid-cols-4 gap-4 p-4">
    @foreach (var img in _images)
    {
        <div class="relative">
            <img src="@img.Url" alt="@img.Title" class="w-full h-48 object-cover rounded-lg" />
            @if (!string.IsNullOrEmpty(img.Title))
            {
                <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2 rounded-b-lg">
                    @img.Title
                </div>
            }
        </div>
    }
</div>

@code {
    private List<ImageModel> _images = new();
    
    protected override void OnInitialized()
    {
        Logger.LogInformation("Entered OnInitialized");
        _images = ImageService.GetImages();
        ImageService.NewImagesFound += SetImages;
    }

    private async Task SetImages()
    {
        Logger.LogInformation("Just entered SetImages");
        
        await InvokeAsync(() => {
            _images = ImageService.GetImages();
            Logger.LogInformation("Just set images");
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        Logger.LogInformation("Disposing Home");
        ImageService.NewImagesFound -= SetImages;
    }
}